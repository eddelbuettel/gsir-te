## ----setup, include=FALSE-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
knitr::opts_chunk$set(echo = TRUE, 
                      eval = TRUE,
                      cache = FALSE,
                      fig.pos = 'H') #, knitr.table.format = 'latex')
library(knitr)
library(data.table)
library(tinyplot)
library(tinytable)
options(width=50)

# Making some aesthetic changes for this document
#theme_set(theme_gray(base_size = 9))
#update_geom_defaults("point", list(size = 0.5))
#update_geom_defaults("boxplot", list(outlier.size = 0.5))
tinytheme("ipsum")

# Temporarily resetting the print limit
op <- options()
options(datatable.print.topn=3, width=50, datatable.print.class=FALSE)


## ----RStudioScreenshot, out.width="3.4in", fig.show='hold', fig.cap="\\label{fig:rstudio}RStudio Screenshot with Console on the left and  Help tab in the bottom right", echo=FALSE-------------------
include_graphics("figures/RStudio-Screenshot.png")


## ----helpttest, echo=TRUE, eval=FALSE-----------------------------------------------------------------------------------------------------------------------------------------------------------------
# help(mean)
# ?mean


## ----aproposShow, echo=TRUE, eval=TRUE----------------------------------------------------------------------------------------------------------------------------------------------------------------
apropos("mean") |> head(16)


## ----egttest, echo=2----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
options(prompt="> ")
example(mean)
options(prompt="R> ")


## ----continuation, echo=TRUE, eval=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------
# +


## ----createObjs---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
height <- 173
height


## ----caseSens1----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
age <- 10
AgE <- 50


## ----caseSens2----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
age
AgE


## ----semicolon----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Name <- "Leo"; Age <- 25; City <- "Lisbon"
Name; Age; City


## ----comments-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# This comment line will be ignored when run.
City     # Text after "#" is ignored.


## ----calcBasic----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
2 + 3           
(5*11)/4 - 7     
# ^ = "to the power of"
7^3 


## ----calcFunctions------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# Square root
sqrt(2)          
# Round down to nearest integer
floor(8.6178)
# Round to 2 decimal places
round(8.6178, 2)


## ----assignBasic--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
roomLength <- 7.8
roomWidth <- 6.4
roomArea <- roomLength * roomWidth
roomArea


## ----assignText---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Greeting <- "Hello World!"
Greeting


## ----cVector------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# A "numeric" vector
x1 <- c(26, 10, 4, 7, 41, 19)
x1
# A "character" vector of country names
x2 <- c("Peru", "Italy", "Cuba", "Ghana")  
x2


## ----repseq-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# Repeat vector (2, 6, 7, 4) three times
r1 <- rep(c(2, 6, 7, 4), times=3)
r1
# Vector from -2 to 3 incremented by half
s1 <- seq(from=-2, to=3, by=0.5)
s1


## ----operationsVecs-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
x1 * 2
round(sqrt(x1*2.6), 2)


## ----MissingValues------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
x2 <- c(3, -7, NA, 5, 1, 1) 
x2
x3 <- c("Rat", NA, "Mouse", "Hamster")
x3


## ----lsrm---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
ls()
rm(x1, x2, x3, r1, s1, AgE, age)
ls()


## ----functionUsage------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
seq(from = 5, to = 8, by = 0.4)


## ----functionAlt--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
seq(from = 5, to = 8, length.out = 16)


## ----installation, eval=FALSE-------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# install.packages(c("data.table", "tinyplot"))


## ----helpCWdata, echo=TRUE, eval=FALSE----------------------------------------------------------------------------------------------------------------------------------------------------------------
# help("ChickWeight")


## ----writeCW, echo=FALSE, message=FALSE, warning=FALSE, eval=TRUE-------------------------------------------------------------------------------------------------------------------------------------
## data.table already loaded above
CW <- data.table(ChickWeight)
if (!file.exists("ChickWeight.csv"))
    fwrite(CW[, .(Chick, Diet, Time, weight)],
           file="ChickWeight.csv")


## ----cwdt---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
suppressMessages(library(data.table))  # tinyverse
cw <- fread("ChickWeight.csv")


## ----printcw------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
cw


## ----cwsummaryActual, echo=3:4, eval=TRUE, result="asis"----------------------------------------------------------------------------------------------------------------------------------------------
str <- function(object, ...) {
    if (!is.data.frame(object)) {
        warning("str.data.frame() called with non-data.frame -- coercing to one.")
        object <- data.frame(object)
    }
    cl <- oldClass(object)
    cl <- cl[cl != "data.frame"]
    if (0 < length(cl)) 
        cat("Classes", paste(sQuote(cl), collapse = ", "), "and ")
    cat("'data.frame':\n  ", nrow(object), " obs. of  ", (p <- length(object)), 
        " variable", if (p != 1) "s", if (p > 0) ":", "\n", sep = "")
  #if (length(l <- list(...)) && any("give.length" == names(l))) 
  #  invisible(NextMethod("str", ...))
  #else invisible(NextMethod("str", give.length = FALSE, ...))
  utils:::str.default(object, vec.len=2, strict.width="wrap", ...)
}
options(digits=5,width=45)
str(cw)
summary(cw)
options(digits=6,width=50)


## ----emptyPlot, echo=2:8, fig.height=1.74-------------------------------------------------------------------------------------------------------------------------------------------------------------
op <- par(mfrow=c(1,2))
# Load the plotting package
library(tinyplot)
cw <- fread("ChickWeight.csv")
# An empty plot (the plot on the left)
plt(weight ~ Time, cw, type = "n")
# With data (the plot on the right)
plt(weight ~ Time, cw)
par(op)


## ----addColourPlot, fig.height=2.0--------------------------------------------------------------------------------------------------------------------------------------------------------------------
plt(weight ~ Time | Diet, cw)


## ----cwfactor, echo=2:3, result="asis"----------------------------------------------------------------------------------------------------------------------------------------------------------------
options(digits=5,width=45)
cw[, Diet := factor(Diet)]  
str(cw)     # notice the difference ?
options(digits=6,width=50)


## ----jitterPlot---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
plt(weight ~ Time | Diet, data = cw, facet = "by")


## ----meanlinesPlot, fig.height=2.0--------------------------------------------------------------------------------------------------------------------------------------------------------------------
plt(weight ~ Time | Diet, cw,
    type = type_summary())


## ----boxPlot------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
plt(weight ~ Time | Diet,
    data = cw,
    facet = "by",
    type="boxplot",
    main = "Chick Weight over Time by Diet")


## ----finalPlot----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
plt(weight ~ Time | Diet,
    data = cw,
    facet = "by",
    type = type_jitter(amount = 1),
    alpha = 0.5,
    legend = FALSE,
    main = "Chick Weight over Time by Diet",
    xlab = "Time (days)",
    ylab = "Weight (grams)")
plt_add(data = cw,
        type = type_summary(),
        col = "darkgrey",
        lwd = 1.5)


## ----dtmutate-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
cw[, weightKg := weight/1000]    # add a column
cw
cw[, Diet := paste0("Diet_", Diet)] # mod col.
cw


## ----dtselect-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# Keep variables Time, Diet and weightKg
cw[, .(Chick, Time, Diet, weightKg)]


## ----condmean, echo=3---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
dt.print.nrows=getOption("datatable.print.nrows")
options(datatable.print.nrows=8)
cw[, .(Mean=mean(weight),SDev=sd(weight)),
   by=.(Diet, Time)]
options(datatable.print.nrows=dt.print.nrows)


## ----dtrename-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
setnames(cw, c("Diet", "weight"),
         c("Group", "Weight"))
cw


## ----dtfilter-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
cw[Time == 21 & Weight > 300]


## ----dtarrange----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
cw[order(Weight)]       # on the fly
setkey(cw, Chick, Time)   # setting a key
cw


## ----cwchained----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
cw21 <- cw[Time %in% c(0,21)][    # i: select rows
  , weight := Weight][            # j: mutate
  , Group := factor(Group)][
  , .(Chick,Group,Time,weight)][  # j: arrange
   order(Chick,Time)][            # i: order
  1:5]                            # i: subset


## ----dtenv--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
col <- "Weight"
fun <- "mean"
out_col <- paste(fun, col, sep="_")
cw[, .(out_col = fun(col)),
   env = list(col=col, fun=fun, out_col=out_col)]


## ----ctstats------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
cw[, .(N    = .N,            # .N is nb per group
       Mean = mean(Weight)), # compute mean
   by=.(Group, Time)][       # group by Diet + Time
   1:5]                      # display rows 1 to 5


## ----dtSum, echo=2:3----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
options(digits=3)  	# tighter display here
cws <- cw[Time %in% c(0,21),
          .(N      = .N, 
            Mean   = mean(Weight),
            SDev   = sd(Weight),
            Median = median(Weight),
            Min    = min(Weight),
            Max    = max(Weight)  ),
          by=.(Group, Time)]
cws


## ----dtpretty-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
cws[, Mean_SD := paste0(format(Mean,digits=1),
                        " (",
                        format(SDev,digits=2),
                        ")")]
cws[, Range := paste(Min, "-", Max)]
prettySum <- cws[ , .(Group, Time, N, Mean_SD, 
                      Median, Range)][
                 order(Group, Time)]
prettySum


## ----dtprettytable------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# library(tinytable)
prettySum |>
  tt(theme = "striped") |>
  style_tt(i = 0, bold = TRUE) |>
  format_tt(escape = TRUE)


## ----reset, include=FALSE-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
options(op)

